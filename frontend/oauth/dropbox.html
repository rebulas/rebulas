<html>
<head></head>
<body>
<p id="message" align="center"></p>

<script>
var params = window.location.hash.substr(1);
var q = parseQueryString(params);

if (window.opener.OAuthCallback) {
  window.opener.OAuthCallback({
      "origin" : "dropbox",
      "token" : q.access_token,
      "type" : q.token_type,
      "uid" : q.uid,
      "state" : q.state
  });
  window.close();
} else {
	document.getElementById("message").innerHTML = "Your access token is " + q.access_token;
}

function parseQueryString(string) {
	var queryString = {};
    string.replace(
            new RegExp("([^?=&]+)(=([^&]*))?", "g"),
            function($0, $1, $2, $3) { queryString[$1] = $3; }
    );

    return queryString;
}
</script>
</body>
<html>
